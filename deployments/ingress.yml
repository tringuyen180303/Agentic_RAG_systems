# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: rag-api
#   namespace: rag-services
# spec:
#   replicas: 4
#   selector:
#     matchLabels: { app: rag-api }
#   template:
#     metadata:
#       labels: { app: rag-api }
#     spec:
#       containers:
#       - name: rag-api
#         image: docker.io/tringuyen180303/rag-api:latest
#         env:
#         - name: OLLAMA_URL
#           value: http://ollama:11434
#         - name: CHROMA_HOST
#           value: chroma
#         - name: CHROMA_PORT
#           value: "8000"
#         - name: LANGFUSE_SECRET_KEY
#           valueFrom:
#             secretKeyRef:
#               name: langfuse-secrets
#               key: secret-key
#         - name: LANGFUSE_PUBLIC_KEY
#           valueFrom:
#             secretKeyRef:
#               name: langfuse-secrets
#               key: public-key
#         - name: LANGFUSE_HOST
#           value: "http://langfuse.observability:3000"
#         ports:
#         - containerPort: 8080
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   name: rag-api
#   namespace: rag-services
# spec:
#   selector: { app: rag-api }
#   ports:
#   - port: 80
#     targetPort: 8080
#   type: ClusterIP
# ---
# apiVersion: networking.k8s.io/v1
# kind: Ingress
# metadata:
#   name: rag-api
#   namespace: ingress-system
#   annotations:
#     kubernetes.io/ingress.class: "gce"
# spec:
#   rules:
#   - host: rag.example.com
#     http:
#       paths:
#       - path: /
#         pathType: Prefix
#         backend:
#           service:
#             name: rag-api
#             port: { number: 80 }

# ingress.yaml  (assuming youâ€™ve enabled an Ingress controller)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: rag-ingress
  namespace: rag-services
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: rag.example.com
    http:
      paths:
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: rag-api
            port: { number: 8080 }
      - path: /chroma
        pathType: Prefix
        backend:
          service:
            name: chroma
            port: { number: 8000 }
